<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Mobile Search Fix</title>
    <link rel="stylesheet" href="floating-navbar.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f5f5f5;
        }
        .test-info {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007cba;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #005a87;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="test-info">
        <h1>üîß Mobile Search Fix Test</h1>
        <p>This page tests the mobile search functionality fixes for the floating navbar.</p>
        
        <h3>Test Steps:</h3>
        <ol>
            <li>Open browser developer tools and switch to mobile view (iPhone/Android)</li>
            <li>Click the search icon in the floating navbar</li>
            <li>Type in the search input field</li>
            <li>Verify that search works without "error occurred" message</li>
        </ol>
        
        <div id="test-status"></div>
        
        <button class="test-button" onclick="testMobileSearch()">Test Mobile Search</button>
        <button class="test-button" onclick="testDesktopSearch()">Test Desktop Search</button>
        <button class="test-button" onclick="simulateError()">Simulate Error Handling</button>
    </div>

    <!-- Mock WordPress environment -->
    <script>
        // Mock tirtonicAjax object for testing
        window.tirtonicAjax = {
            ajaxurl: '/wp-admin/admin-ajax.php',
            nonce: 'test-nonce-123',
            woocommerce_active: true,
            cart_url: '/cart',
            checkout_url: '/checkout',
            shop_url: '/shop'
        };

        // Mock fetch for testing
        const originalFetch = window.fetch;
        window.fetch = function(url, options) {
            console.log('Mock AJAX call:', url, options);
            
            // Simulate successful search response
            return Promise.resolve({
                ok: true,
                status: 200,
                json: () => Promise.resolve({
                    success: true,
                    data: [
                        {
                            id: 1,
                            title: 'Test Product 1',
                            url: '/product/test-1',
                            price: '$19.99',
                            image: 'https://via.placeholder.com/150x150/007cba/ffffff?text=Product+1'
                        },
                        {
                            id: 2,
                            title: 'Test Product 2',
                            url: '/product/test-2',
                            price: '$29.99',
                            image: 'https://via.placeholder.com/150x150/28a745/ffffff?text=Product+2'
                        }
                    ]
                })
            });
        };

        function showStatus(message, type = 'success') {
            const statusDiv = document.getElementById('test-status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function testMobileSearch() {
            showStatus('Testing mobile search functionality...', 'success');
            
            // Simulate mobile environment
            Object.defineProperty(window, 'innerWidth', {
                writable: true,
                configurable: true,
                value: 375
            });
            
            // Test if navbar exists
            const navbar = document.getElementById('tirtonicFloatingNav');
            if (!navbar) {
                showStatus('‚ùå Navbar element not found! Make sure the navbar is rendered.', 'error');
                return;
            }
            
            // Test search icon click
            const searchIcon = navbar.querySelector('.tirtonic-nav-search');
            if (!searchIcon) {
                showStatus('‚ùå Search icon not found!', 'error');
                return;
            }
            
            // Simulate search icon click
            searchIcon.click();
            
            setTimeout(() => {
                const mobileContent = document.getElementById('mobile-fullscreen-content');
                if (mobileContent) {
                    showStatus('‚úÖ Mobile search opened successfully! Search functionality should now work without errors.', 'success');
                } else {
                    showStatus('‚ö†Ô∏è Mobile fullscreen content not created. Check mobile view logic.', 'error');
                }
            }, 500);
        }

        function testDesktopSearch() {
            showStatus('Testing desktop search functionality...', 'success');
            
            // Simulate desktop environment
            Object.defineProperty(window, 'innerWidth', {
                writable: true,
                configurable: true,
                value: 1200
            });
            
            const navbar = document.getElementById('tirtonicFloatingNav');
            if (!navbar) {
                showStatus('‚ùå Navbar element not found!', 'error');
                return;
            }
            
            const searchIcon = navbar.querySelector('.tirtonic-nav-search');
            if (searchIcon) {
                searchIcon.click();
                setTimeout(() => {
                    const searchInput = navbar.querySelector('#tirtonic-search-input, #search--revamp input');
                    if (searchInput) {
                        showStatus('‚úÖ Desktop search opened successfully!', 'success');
                        // Simulate typing
                        searchInput.value = 'test';
                        searchInput.dispatchEvent(new Event('input'));
                    } else {
                        showStatus('‚ùå Search input not found!', 'error');
                    }
                }, 300);
            }
        }

        function simulateError() {
            showStatus('Testing error handling...', 'success');
            
            // Temporarily override fetch to simulate error
            window.fetch = function() {
                return Promise.reject(new Error('Network error'));
            };
            
            setTimeout(() => {
                // Restore original fetch
                window.fetch = originalFetch;
                showStatus('‚úÖ Error handling test completed. Check console for error messages.', 'success');
            }, 2000);
        }

        // Initialize navbar when page loads
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof initTirtonicNav === 'function') {
                initTirtonicNav();
                showStatus('‚úÖ Navbar initialized successfully!', 'success');
            } else {
                showStatus('‚ö†Ô∏è Navbar initialization function not found. Include floating-navbar.js', 'error');
            }
        });
    </script>

    <!-- Include the floating navbar HTML structure -->
    <div id="tirtonicFloatingNav" class="tirtonic-floating-nav" data-settings='{"enable_navbar":true,"enable_search":true,"enable_cart":true,"search_placeholder":"Search products...","navbar_title":"Quick Access"}'>
        <div class="tirtonic-nav-header">
            <div class="tirtonic-nav-toggle">
                <span class="tirtonic-nav-title">Quick Access</span>
                <span class="tirtonic-nav-arrow">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7 10l5 5 5-5z"/>
                    </svg>
                </span>
            </div>
            
            <div class="tirtonic-nav-actions">
                <div class="tirtonic-nav-search" title="Search">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                    </svg>
                </div>
                
                <div class="tirtonic-nav-cart" title="Cart">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                    </svg>
                    <span class="cart-count">0</span>
                </div>
            </div>
        </div>
        
        <div class="tirtonic-nav-content">
            <button class="tirtonic-nav-close" style="display: none;">&times;</button>
            
            <div class="tirtonic-search-section" style="display: none;">
                <form id="search--revamp">
                    <div class="form-group">
                        <input type="text" id="tirtonic-search-input" placeholder="Search for products" />
                        <span class="search--icon">
                            <svg width="25" height="25" viewBox="0 0 25 25" fill="none">
                                <path d="M19.7873 18.0789L24.9626 23.253L23.2528 24.9628L18.0787 19.7875C16.1535 21.3308 13.7589 22.1702 11.2915 22.1667C5.2885 22.1667 0.416504 17.2947 0.416504 11.2917C0.416504 5.28867 5.2885 0.416672 11.2915 0.416672C17.2945 0.416672 22.1665 5.28867 22.1665 11.2917C22.17 13.7591 21.3306 16.1537 19.7873 18.0789ZM17.3634 17.1823C18.8966 15.6051 19.7529 13.4913 19.7498 11.2917C19.7498 6.61905 15.9641 2.83334 11.2915 2.83334C6.61888 2.83334 2.83317 6.61905 2.83317 11.2917C2.83317 15.9643 6.61888 19.75 11.2915 19.75C13.4911 19.7531 15.6049 18.8967 17.1821 17.3635L17.3634 17.1823Z" fill="black"/>
                            </svg>
                        </span>
                        <span class="close--icon" style="display: none;">
                            <svg class="Icon Icon--close" role="presentation" viewBox="0 0 16 14">
                                <path d="M15 0L1 14m14 0L1 0" stroke="currentColor" fill="none" fill-rule="evenodd"></path>
                            </svg>
                        </span>
                    </div>
                </form>
                <div class="newest--product">
                    <div class="newest--product-wrapper">
                        <h3>Newest Products</h3>
                        <div class="newest--product-list">
                            <!-- Products will be loaded here -->
                        </div>
                    </div>
                    <div class="newest--product-searched" style="display: none;">
                        <h3>Search Results</h3>
                        <div class="searched--product-list"></div>
                    </div>
                </div>
            </div>
            
            <div class="wrapper-menu">
                <div class="quick--access-content_link1">
                    <a href="/">Home</a>
                    <a href="/shop">Shop</a>
                    <a href="/about">About</a>
                    <a href="/contact">Contact</a>
                </div>
                <div class="quick--access-content_link2">
                    <a href="/support">Support</a>
                    <a href="/faq">FAQ</a>
                </div>
            </div>
            
            <div class="wrapper-cart" style="display: none;">
                <div class="Drawer__Main">
                    <div class="empty-cart">Your cart is empty</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Include the JavaScript -->
    <script src="floating-navbar.js"></script>
</body>
</html>